<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>inflow-put Consumer Guide</title>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <style>
    :root {
      --bg: #1a1a2e;
      --surface: #16213e;
      --primary: #0f3460;
      --accent: #e94560;
      --text: #eaeaea;
      --text-muted: #a0a0a0;
      --code-bg: #0d1117;
    }

    * { box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      margin: 0;
      padding: 2rem;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    h1 {
      color: var(--accent);
      border-bottom: 2px solid var(--accent);
      padding-bottom: 0.5rem;
    }

    h2 {
      color: var(--accent);
      margin-top: 3rem;
    }

    h3 {
      color: var(--text);
      margin-top: 2rem;
    }

    .mermaid {
      background: var(--surface);
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    pre {
      background: var(--code-bg);
      border-radius: 8px;
      padding: 1rem 1.5rem;
      overflow-x: auto;
      border-left: 3px solid var(--accent);
    }

    code {
      font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
      font-size: 0.9rem;
    }

    .inline-code {
      background: var(--code-bg);
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.85rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5rem 0;
      background: var(--surface);
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      padding: 0.75rem 1rem;
      text-align: left;
      border-bottom: 1px solid var(--primary);
    }

    th {
      background: var(--primary);
      color: var(--accent);
      font-weight: 600;
    }

    tr:last-child td {
      border-bottom: none;
    }

    .card {
      background: var(--surface);
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    .highlight {
      color: var(--accent);
      font-weight: 600;
    }

    .flow-description {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .flow-item {
      background: var(--surface);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
    }

    .flow-item h4 {
      color: var(--accent);
      margin: 0 0 0.5rem 0;
    }

    .flow-item p {
      margin: 0;
      color: var(--text-muted);
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>inflow-put Consumer Guide</h1>
    <p>How downstream applications consume the <code class="inline-code">inflow-put</code> library to write changes back to the Inflow Inventory API.</p>

    <h2>The Ecosystem</h2>
    <p>Three packages work together to provide complete Inflow API integration:</p>

    <div class="mermaid">
flowchart LR
    subgraph types["inflow-api-types"]
        ZOD[("Zod Schemas<br/>GET + PUT")]
    end

    subgraph get["inflow-get"]
        SYNC["API Sync"]
        DB[(SQLite)]
        SYNC --> DB
    end

    subgraph put["inflow-put"]
        BUILD["Payload Builder"]
        PUT["PUT Client"]
        BUILD --> PUT
    end

    API[("Inflow<br/>Cloud API")]

    types --> get
    types --> put
    API -->|"GET"| get
    put -->|"PUT"| API

    style types fill:#0f3460,stroke:#e94560
    style get fill:#0f3460,stroke:#e94560
    style put fill:#0f3460,stroke:#e94560
    style API fill:#1a1a2e,stroke:#e94560,stroke-width:2px
    </div>

    <div class="flow-description">
      <div class="flow-item">
        <h4>inflow-api-types</h4>
        <p>Zod schemas for validation.<br/>Types for both GET and PUT.</p>
      </div>
      <div class="flow-item">
        <h4>inflow-get</h4>
        <p>Syncs API to SQLite.<br/>Query locally with Drizzle ORM.</p>
      </div>
      <div class="flow-item">
        <h4>inflow-put</h4>
        <p>Writes SQLite changes back.<br/>Validates before sending.</p>
      </div>
    </div>

    <h2>Consumer Workflow</h2>

    <div class="mermaid">
sequenceDiagram
    participant App as Your App
    participant Get as inflow-get
    participant DB as SQLite
    participant Put as inflow-put
    participant API as Inflow API

    Note over App,API: Phase 1: Sync Data
    App->>Get: npm run seed
    Get->>API: GET /products, /customers, etc.
    API-->>Get: JSON responses
    Get->>DB: Store validated data

    Note over App,API: Phase 2: Query Locally
    App->>DB: SELECT * FROM products
    DB-->>App: Product rows

    Note over App,API: Phase 3: Write Back
    App->>Put: putProduct(client, payload)
    Put->>Put: Validate with Zod
    Put->>Put: Strip readOnly fields
    Put->>API: PUT /products
    API-->>Put: Success/Error
    Put-->>App: Result
    </div>

    <h2>Usage Examples</h2>

    <h3>1. Setup Client</h3>
    <pre><code>import { createClient, putProduct, putCustomer } from 'inflow-put'

const client = createClient({
  apiKey: process.env.INFLOW_API_KEY,
  companyId: process.env.INFLOW_COMPANY_ID,
})</code></pre>

    <h3>2. Update Existing Entity</h3>
    <pre><code>// Update a product's name
await putProduct(client, {
  productId: 'existing-uuid-here',  // Required for update
  name: 'New Product Name',
  description: 'Updated description',
  // TypeScript autocomplete shows valid fields
  // Zod validates before API call
})</code></pre>

    <h3>3. Create New Entity</h3>
    <pre><code>import { randomUUID } from 'crypto'

// Create a new customer
await putCustomer(client, {
  customerId: randomUUID(),  // Generate new UUID
  name: 'Acme Corp',         // Required for create
  email: 'orders@acme.com',
  isActive: true,
})</code></pre>

    <h3>4. Nested Arrays (e.g., Product Prices)</h3>
    <pre><code>// Add/update product prices
await putProduct(client, {
  productId: 'existing-product-id',
  prices: [
    {
      productPriceId: randomUUID(),  // New price
      pricingSchemeId: 'scheme-uuid',
      unitPrice: '29.99',
    },
    {
      productPriceId: 'existing-price-id',  // Update existing
      unitPrice: '24.99',
    },
  ],
})</code></pre>

    <h2>Type Safety Flow</h2>

    <div class="mermaid">
flowchart TD
    subgraph compile["Compile Time"]
        TS["TypeScript"]
        AC["Autocomplete"]
        ERR["Type Errors"]
    end

    subgraph runtime["Runtime"]
        ZOD["Zod Validation"]
        STRIP["Strip readOnly"]
        SEND["API Call"]
    end

    subgraph constraints["Constraint Checks"]
        RO["readOnly fields blocked"]
        IM["immutable fields checked"]
        REQ["required fields validated"]
    end

    TS --> AC
    TS --> ERR
    AC --> ZOD
    ZOD --> constraints
    constraints --> STRIP
    STRIP --> SEND

    style compile fill:#16213e,stroke:#e94560
    style runtime fill:#16213e,stroke:#e94560
    style constraints fill:#0f3460,stroke:#e94560
    </div>

    <h2>Field Constraints</h2>
    <p>Each entity has constraints that the library enforces:</p>

    <table>
      <tr>
        <th>Constraint</th>
        <th>Meaning</th>
        <th>Example (Product)</th>
      </tr>
      <tr>
        <td><span class="highlight">readOnly</span></td>
        <td>Cannot be sent in PUT requests</td>
        <td>lastModifiedDateTime, cost, totalQuantityOnHand</td>
      </tr>
      <tr>
        <td><span class="highlight">immutable</span></td>
        <td>Set on create only, cannot update</td>
        <td>itemType, trackSerials</td>
      </tr>
      <tr>
        <td><span class="highlight">required.create</span></td>
        <td>Must provide when creating</td>
        <td>productId, name, itemType</td>
      </tr>
      <tr>
        <td><span class="highlight">required.update</span></td>
        <td>Must provide when updating</td>
        <td>productId</td>
      </tr>
      <tr>
        <td><span class="highlight">nestedWithIds</span></td>
        <td>Nested arrays require item IDs</td>
        <td>prices, vendorItems, itemBoms</td>
      </tr>
    </table>

    <h2>Entity Coverage</h2>

    <div class="mermaid">
flowchart TB
    subgraph phase1["Phase 1: Core Master Data"]
        P[Products]
        V[Vendors]
        C[Customers]
    end

    subgraph phase2["Phase 2: Inventory Operations"]
        SA[Stock Adjustments]
        ST[Stock Transfers]
        PCA[Product Cost Adjustments]
        CS[Count Sheets]
        SC[Stock Counts]
    end

    subgraph phase3["Phase 3: Order Management"]
        PO[Purchase Orders]
        SO[Sales Orders]
        MO[Manufacturing Orders]
    end

    subgraph phase4["Phase 4: Configuration"]
        CFD[Custom Field Definitions]
        CFO[Custom Field Options]
        CF[Custom Fields]
        WH[Webhooks]
        SS[Stockroom Scans]
    end

    phase1 --> phase2
    phase2 --> phase3
    phase3 --> phase4

    style phase1 fill:#0f3460,stroke:#e94560
    style phase2 fill:#0f3460,stroke:#e94560
    style phase3 fill:#0f3460,stroke:#e94560
    style phase4 fill:#0f3460,stroke:#e94560
    </div>

    <h2>What Consumers Get</h2>

    <div class="card">
      <table>
        <tr>
          <th>Benefit</th>
          <th>How</th>
        </tr>
        <tr>
          <td><span class="highlight">Confidence</span></td>
          <td>If it compiles and passes Zod, it will work</td>
        </tr>
        <tr>
          <td><span class="highlight">Discovery</span></td>
          <td>Types show what's possible without reading docs</td>
        </tr>
        <tr>
          <td><span class="highlight">No Guessing</span></td>
          <td>Constraints are built-in, not documented elsewhere</td>
        </tr>
        <tr>
          <td><span class="highlight">Tested Contract</span></td>
          <td>Integration tests prove the library matches reality</td>
        </tr>
      </table>
    </div>

    <h2>Installation</h2>
    <pre><code># Install from npm (when published)
npm install inflow-put

# Or from GitHub
npm install github:ldraney/inflow-put</code></pre>

    <h2>Package Exports</h2>
    <pre><code>import {
  // Client factory
  createClient,

  // Entity functions (16 total)
  putProduct,
  putVendor,
  putCustomer,
  putPurchaseOrder,
  putSalesOrder,
  putManufacturingOrder,
  putStockAdjustment,
  putStockTransfer,
  putProductCostAdjustment,
  putCountSheet,
  putStockCount,
  putCustomFieldDefinition,
  putCustomFieldDropdownOption,
  putCustomField,
  putWebhook,
  putStockroomScan,
} from 'inflow-put'</code></pre>

  </div>

  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'dark',
      themeVariables: {
        primaryColor: '#0f3460',
        primaryTextColor: '#eaeaea',
        primaryBorderColor: '#e94560',
        lineColor: '#e94560',
        secondaryColor: '#16213e',
        tertiaryColor: '#1a1a2e',
        background: '#1a1a2e',
        mainBkg: '#16213e',
        nodeBorder: '#e94560',
        clusterBkg: '#16213e',
        clusterBorder: '#e94560',
        titleColor: '#e94560',
        edgeLabelBackground: '#16213e',
      }
    });
  </script>
</body>
</html>
</code></pre>
